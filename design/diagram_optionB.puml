@startuml
' Diagramme de classes - Option B (saisie libre pour les produits)
' Ce diagramme reflète le code actuel : Achat + LigneAchat (libelleProduit libre), services et écrans.

package "Domain Models" {
  class Achat {
    +int id
    +String nomListe
    +Date dateAchat
    +float montantTotal
    +modifierListe(): void
    +creerListe(): Achat
    +supprimerListe(): void
    +consulterTableauArticles(): List<LigneAchat>
  }

  class LigneAchat {
    +int id
    +int idAchat
    +String libelleProduit
    +float quantite
    +float prixUnitaire
    +float prixTotal
    +bool estCoche
    +calculerMontant(): float
    +modifierArticle(qte: float, pu: float): void
    +supprimerArticle(): void
  }

  class Statistique {
    +Date periodeStart
    +Date periodeEnd
    +Map<String,float> montantParProduit
    +compute(db: DBService, filter: StatFilter): void
    +consultStatistique(): Report
  }
}

package "Services / Persistence" {
  class DBService {
    +connect(): void
    +getAchat(id:int): Achat
    +getLignes(idAchat:int): List<LigneAchat>
    +addLigne(l:LigneAchat): int
    +updateLigne(l:LigneAchat): void
    +deleteLigne(id:int): void
    +runMigration(): void
  }

  class AchatService {
    +createAchat(name:String): Achat
    +copyAchat(id:int): Achat
    +saveAchatName(id:int, name:String): void
    +addProduitInline(idAchat:int, libelle:String, qte:float, pu:float): LigneAchat
    +getLignes(idAchat:int): List<LigneAchat>
  }

  class RapportService {
    +generateGlobalReport(filter: ReportFilter): Rapport
    +generateByProduit(filter: ReportFilter): Rapport
  }
}

package "UI / Controllers" {
  class AchatScreen {
    +Achat currentAchat
    +List<LigneAchat> lignes
    +TextInput inputNomListe
    +TextInput inputProduit
    +openQtyPuPopup(libelle:String): void
    +onAddProduit(libelle:String): void
    +onEditLigne(id:int): void
    +onDeleteLigne(id:int): void
  }

  class RapportScreen {
    +filters
    +display(rapport: Rapport): void
  }
}

' Relations
Achat "1" -- "0..*" LigneAchat : contient
AchatService ..> DBService : utilise
RapportService ..> DBService : utilise
AchatScreen ..> AchatService : utilise
AchatScreen ..> DBService : utilise
RapportScreen ..> RapportService : utilise
DBService --> LigneAchat : persiste
DBService --> Achat : persiste

note top of LigneAchat
  Dans Option B, LigneAchat.libelleProduit est
  une chaîne libre (pas de table Produit).
end note

@enduml
